Spec - Foundations
==================

The Foundations specification is about defining the structure of webinos applications and how they are able to interact with webinos. This also includes packaging of applications, application APIs and embedding webinos extensions in applications.

Formal Specification of Webinos Application
-------------------------------------------

A webinos application is defined as follows (citing D2.2):

<pre>
An application written using webinos technologies that will run on a device, across a range of devices reflecting the domains mobile,
stationary devices, automotive or home media and/or server. The application will be able to securely and consistently access device specific features,
communicate over the cloud and adjust to the device and context specific situation.
</pre>

Webinos technologies include several existing and upcoming web technologies, as well as webinos-specific add-ons which enable applications to be developed for multiple platforms. This including access to device features, transparent communication across devices, and secure application execution. The relevant web technologies, if already available, are referred in the dedicated sections of this specification.

![]({width:350px}Webinos_Application_Package_Neu.png)

A webinos application package consists of four types of metadata put together in an application manifest file.
# Application metadata provides human-readable semantic information about the application itself, e.g., version, description, author etc., which can be presented to the user and is accessible by the application using APIs.
# The content provides all the application and layout logic and also media content such as images and video needed by the application.
# The deployment and configuration metadata provides information for the Web runtime about how to deploy and install the application, e.g., whether the application can run in the background or not and which view mode the application prefers to use. This metadata also contains information about distributed application deployment as well as any additional functionality the application will expose.
# The runtime and execution metadata part of the application package provides information about conditions which must be fulfilled to execute the application, e.g., fulfilled policies or conditions under which the application may be automatically executed (non user driven).

### Packaging

The core structure and content of webinos applications is defined through the W3C Widget Packaging and Configuration [Widgets] specification. Webinos application packaging, as a superset of W3C Widget packaging, adds some further features to this specification in order to meet additional requirements. The following requirements show that webinos must conform with various W3C specifications.

`WRT-01: The webinos WRT MUST be capable of processing widget packages as defined in [Widgets].`

`WRT-02: The webinos WRT MUST support the [WidgetDigSig] specification in order to verify the author and/or distributor of the application.`

`WRT-03: The webinos WRT MUST support application network access control as defined in the Widget Access Request Policy [WARP] for applications that want to communicate with remote resources.`

`WRT-04: The webinos WRT MUST implement the URI scheme as defined in [WidgetURI] to address resources within W3C Widget and webinos application packages.`

In addition to the XML elements defined in the Widget configuration document [Widgets] webinos applications can make use of webinos-specific extensions. The following separate webinos-specific XML namespace must be used to reference webinos-specific xml elements.

Webinos Extension XML namespace: `http://www.webinos.org/webinosapplication`

The following elements are webinos-specific extensions to the metadata part of the [Widgets] specification and MUST be supported by webinos WRTs.

**The `distributor` element**

A distributor element represents people or an organization that distributed the instance of a webinos application. Commonly application stores are distributors.

Context in which this element is used: `As a child of the widget element.`
Content model: `Any.`
Occurrences: `Zero or one.`
Attributes: `href, email.`

`The email attribute represents an email address associated with the distributor. The email attribute is optional.`

`The href attribute represents an URI that associates with the distributor. The href attribute is optional.`

**Example of Usage:**
<pre><code class="xml">
<widget xmlns="http://www.w3.org/ns/widgets"
 xmlns:webinos="http://www.webinos.org/webinosapplication">
 <webinos:distributor email="info@examplarystore.com" href="http://www.exemplarystore.com">
 Examplary Store
 </webinos:distributor>
 <content src="widget.html"/>
</widget>
</code></pre>

**The `versionName` attribute of the `widget` element**

A version name element represents the version of the application in a human-readable manner. The versionName element is optional and is not used for application life cycle management, e.g., application update.

Context in which this element is used: `As a parameter of the widget element.`
Content model: `Any.`
Occurrences: `Zero or one.`

**Example of Usage:**
<pre><code class="xml">
<widget xmlns="http://www.w3.org/ns/widgets"
 xmlns:webinos="http://www.webinos.org/webinosapplication"
 webinos:versionName="Silver">
 <content src="widget.html"/>
</widget>
</code></pre>

**The `validfor` attribute of the `widget` element**

The _validfor_ attributed defines a time period when the application is valid and can be used. The time frame is specified in elapsed milliseconds after the first application execution. If the specified time is elapsed the user should not be able to execute the application any more. This value gives only the semantic information without any security or licensing mechanism behind. Additional security, digital rights management (DRM) or licensing methods are implementation specific and left unspecified.

Context in which this element is used: `As a parameter of the widget element.`
Content model: `Number.`
Occurrences: `Zero or one.`

**Example of Usage: Application valid for one week**
<pre><code class="xml">
<widget xmlns="http://www.w3.org/ns/widgets"
 xmlns:webinos="http://www.webinos.org/webinosapplication"
 webinos:validfor="604800000">
 <content src="widget.html"/>
</widget>
</code></pre>

**The `validuntil` attribute of the `widget` element**

The _validuntil_ attributed defines a date and time until the application is valid and can be used. The time frame is specified as in milliseconds whereas the date and time is encoded as milliseconds since midnight of January 1, 1970, according to universal time. If the specified date and time is reached the user should not be able to execute the application any more. This value gives only the semantic information without any security or licensing mechanism. Additional security, digital rights management or licensing methods are implementation specific and left unspecified.

Context in which this element is used: `As a parameter of the widget element.`
Content model: `Number.`
Occurrences: `Zero or one.`

**Example of Usage: Application valid until 12.31.2011 12am.**
<pre><code class="xml">
<widget xmlns="http://www.w3.org/ns/widgets"
 xmlns:webinos="http://www.webinos.org/webinosapplication"
 webinos:validuntil="1325332800000">
 <content src="widget.html"/>
</widget>
</code></pre>

**The `copy-restricted` element**

Adding the _copy-restricted_ element to the configuration document indicates that copy, export or installation of the application on another device using webinos application sharing features is forbidden. It is possible to allow copies on devices belonging to the same personal zone as the device where the application was installed at first, using the _restricted-to_ attribute with the value ‘personal-zone’. If the element is absent no restrictions are applied and exporting the application to the file system and installing it on another device is possible if the WRT provides means for exporting applications. The information provided by the _copy-restricted_ element gives only the semantic information without any security or licensing mechanism. Additional security, digital rights management or licensing methods are implementation specific and left unspecified.

Context in which this element is used: `As a child of the widget element.`
Content model: `None.`
Occurrences: `Zero or one.`

Context in which the restricted-to attribute is used: `As an attribute of the copy-restricted element.`
Content model: `DOMString.`
Occurrences: `Zero or one.`

**Example of Usage: Allowing copies on devices of the same zone**
<pre><code class="xml">
<widget xmlns="http://www.w3.org/ns/widgets"
 xmlns:webinos="http://www.webinos.org/webinosapplication">
 <content src="widget.html"/>
 <webinos:copy-restricted webinos:restricted-to="personal-zone"/>
</widget>
</code></pre>

### Application Interface

In [WidgetAPI] the W3C defines an API to access application specific data defined in the configuration document as well as a persistence model. This API is used and extended to provide support for the webinos-specific XML elements defined in this specification.

<pre><code class="javascript">
interface Widget {

//webinos-specific attributes
 readonly attribute DOMString distributor;
 readonly attribute DOMString distributorEmail;
 readonly attribute DOMString distributorHref;

readonly attribute DOMString versionName;
 readonly attribute unsigned long long validfor;
 readonly attribute unsigned long long validuntil;

//Widget standard attributes
 readonly attribute DOMString author;
 readonly attribute DOMString authorEmail;
 readonly attribute DOMString authorHref;
 readonly attribute DOMString description;
 readonly attribute DOMString id;
 readonly attribute DOMString name;
 readonly attribute DOMString shortName;
 readonly attribute Storage preferences;
 readonly attribute DOMString version;
 readonly attribute unsigned long height;
 readonly attribute unsigned long width;
};
</code></pre>

As shown in the Widget object interface description several webinos-specific attributes are added. The meaning of each new attribute is described in the following list.

-   `distributor` attribute: The distributor attribute provides read only access to the distributor element’s content of the config.xml if available. Otherwise this attribute is NULL.
-   `distributorEmail` attribute: The distributorEmail attribute provides read only access to the distributor’s email adress if available. Otherwise this attribute is NULL.
-   `distributorHref` attribute: The distributorHref attribute provides read only access to the distributor’s URI reference if available. Otherwise this attribtue is NULL.
-   `versionName` attribute: A human readable version name. If not set in the configuration document it contains the same value as the version attribute.
-   `validfor` attribute: A numeric value represented in milliseconds that indicates how long the application can be used before usage should be prohibited.
-   `validuntil` attribute: A numeric value represented in milliseconds since midnight of January 1, 1970, according to universal time that indicates until when the application can be used before usage should be prohibited.

The following specification for distributed webinos applications will add more extensions to the Widget application interface as well as to the Widget packaging and configuration specification which are described more comprehensively and have their own sections in the document.

### Distributed Webinos Applications

Webinos allows the creation of multi-device or distributed applications not only from the execution environment point of view but also from the deployment and packaging point of view. Webinos allows developers to design their applications in a way that applications (or only parts of them) can be automatically or programmatically deployed on to other devices, e.g., because they are more suitable for the execution of the application code because of the application design, the feature access or because of performance reasons.

The webinos distributed application functionality allows the packaging of any number of sub-applications, referred to as child applications, within a main webinos application package, referred to as the parent application. Child applications are also full webinos applications and follow the webinos application packaging specification.

Application code encapsulated in child applications can be code where the developer decides that it makes sense to create specific application modules for performing certain tasks, the functionalities provided by the modules can be used by the parent application and also can be shared between other applications. Thus, application distribution is not only about outsourcing code to other devices but also about using functionalities provided by one application across others and de-coupling application logic.

### Use Case Examples

**1 Smart Text Input:**

`Using a smartphone as text input device for applications running on a TV set. Here, the smartphone not only sends key-codes to the â€œmainâ€ application, it also shows some appropriate graphics in order to support the text input. In addition, the outsourced code running on the smartphone may check the text input in order to prevent sending of unnecessary or incorrect data to the â€œmainâ€ application.`

**2 Smart sensors:**

`Assume that an application wants to be informed when remotely available sensor data (real sensor or any another webinos enable/compatible device) crosses a specific measurement threshold. The application could check the sensor reading periodically and take some action based on this. Since this would produce unnecessary traffic and needs the primary application to run continuously, it would be better to only get a sensor event if the threshold is reached. To achieve this, the application may outsource a piece of code to the desired sensor or device. The code locally checks the sensor/requested data until the threshold is reached. The outsourced code informs the â€œmainâ€ application via an event system about this so that the application can perform a specific action.`

**3 Component sharing:**

`The Android Intent programming paradigm (see http://developer.android.com/reference/android/content/Intent.html) allows easy sharing of application components between other applications. For example a tiny application is only designed for picking a location from a map and providing the attached geographic location for the selected map position. Since this task is common across multiple applications it would be an ideal candidate for cross application sharing of services. Thus, the application is able to be invoked from other applications and could send back the result to the calling application. Other possibilities like these borrowed from Android Intents could be provided to webinos applications by using the application distribution mechanism not only for distributing applications but also for sharing application features. `

### Packaging of Distributable Applications

Applications that want to make use of webinos distributed application features have to declare the child applications which should be made available. Three child application deployment options can be considered:

-   An application can outsource functionality to the child application for any application specific reason, on the same device or other device, to be accessible using the webinos discovery service (if shared functions are declared).
-   An application can share functions with other applications to allow reuse of existing code between multiple applications without allowing access to the whole application but to a dedicated component.
-   An application can package multiple child applications in one application package in order to ship and install multiple applications at once.

![]({width:350px}Webinos_Application_Package_Neu_2.png)

To declare code as being a child application two steps are needed:
# Package the components to make them distributable.
# Declare those components as being distributable.

Packaging a child application as a distributable application works exactly the same way as packaging a full webinos application. Thus, a child application could be as content-rich as a full webinos application but with a dedicated small single purpose. Applications which do not declare any child application do not need any distributed application related processing by the WRT. They will be installed as described in [Widgets].

![]({width:450px}Webinos_Application_Package_Neu_3.png)

`Note: In the current release webinos, supports only pre-defined child applications which are available in the parentâ€™s application package during application installation. Future versions may support dynamic creation of application packages during application runtime by providing appropriate APIs.  Both the parent and child applications must be signed by the same authority.`

Packaged child applications must be placed in the webinos-specific â€˜componentsâ€™ folder which must be located in the root folder of the parentâ€™s application package.

**Exemplary application structure:**

-   root
    -   config.xml
    -   app.html
    -   icon.png
    -   Scripts
        -   app.js
    -   Styles
        -   small.css
        -   big.css
    -   Components
        -   child1.wgt
        -   child2.wgt
        -   child3.wgt

**Application Installation on multiple Devices**

**Automatic Deployment**

During installation of a parent application its child applications, if any, can be automatically installed on the same device as the parent application. The WRT may provide the possibility to also install child applications on other devices if not prohibited by the child application definition in the configuration file (config.xml).

The child application that should be installed on other devices must provide a child element in the applicationâ€™s configuration document. This will trigger the webinos runtime to install the related child application. If the element is absent, the related child application will not be automatically deployed.

**Example of Usage:**

<pre><code class="xml">
<widget xmlns="http://www.w3.org/ns/widgets"
 xmlns:webinos="http://www.webinos.org/webinosapplication"
 id=â€http://exampleapp.org/app1â€ webinos:type="container">
 <webinos:child webinos:install="any">child1.wgt</webinos:child>
 <webinos:child webinos:install=â€localâ€>child2.wgt</webinos:child>
 <webinos:child>child3.wgt</webinos:child>
</widget>
</code></pre>

-   Line 3: The application package is defined as type ‘container’. This means that no parent application exists in the application package but, if defined in the manifest, child applications can be installed when the WRT processes the application package, it is a convenience mode for installing multiple applications using only one package. After the WRT finished processing the package it can be removed from the device because there is no application that can be executed. If no parent and no child applications are defined nothing has to be installed and the application package can be removed. The type attribute is optional. If the type is set to ‘container’ the content element is not evaluated and can be absent. The other way round, if the container attribute is absent, the content element must be declared in the manifest.
-   Line 4-5: The install attribute specifies whether a child application should be installed directly after installing the main application package (set to ‘any’ or ‘local’) or not (any other value or absent). If not set to one of the allowed values, child applications can be installed later using the webinos Widget API. Before starting installation of a webinos application the WRT has to check if any declared child applications are available. If not the installation process must be cancelled and the user must be informed about an invalid application package. If _install_ is set to ‘any’ the WRT must show a native WRT dialog to the user containing a set of available devices where the child application can be installed on to the user. Available devices could be every device of the userâ€™s personal zone or other devices accessible to the user. The WRT must show information about the child application available in the configuration document (e.g., author, title, version, description,…) to the user based on the application package source and destination device, to allow the user to double check what will be installed. If ‘any’ is specified, the user may select one, more or all available devices for installing the child application. Afterwards the WRT has to install the application on the selected device as specified in section Inter-Runtime Application Deployment. If set to ‘local’ the related child application must be installed on the same device as the main application was previously installed. The user does not have to select a target device, but should be informed that this will install only locally.
-   Line 6: Each child application contained in the application package must be advertised using the child element. Child applications contained in the package but not advertised in the configuration document are rejected by the WRT and, thus, cannot be automatically installed during application installation phase or using the webinos Widget API. Before starting installation of a webinos application the WRT has to check if any child application declared in the configuration document is also physically available in the package. If not the installation process must be cancelled and the user must be informed about an invalid application package.

`Note: In future versions more advanced automatic deployment mechanisms may be introduced which allowing stating a number of filters within the remote-install element of the configuration document in order to define appropriate devices for application deployment.`

**On Request Deployment**

Webinos allows remote installation during installation of the parent application and it is also possible to deploy code on demand at the application runtime. Webinos provides an application deployment API using the Widget interface which takes the application ID of the child that should be installed. The application ID must be specified in the configuration document of the child as specified in [Widgets]. Following the WebIDL specification for deploying child applications:

<pre><code class="javascript">

[Callback=FunctionOnly, NoInterfaceObject] interface DeploymentSuccessCallback {
 //called if a child application was successfully installed
 //childID is the application id which was used during deployChild
 //serviceID is the unique application id that can be used to explicitly address the deployed service within webinos service discovery
 void onSuccess(in DOMString childID, in DOMString serviceID);
 };
[Callback=FunctionOnly, NoInterfaceObject] interface DeploymentErrorCallback {
 void onError (in DeploymentError error);
 };

interface DeploymentError {
 const unsigned short INSTALLATION_CANCELED_BY_USER = 101;
 const unsigned short PERMISSION_DENIED_ERROR = 102;
 const unsigned short NOT_REACHABLE = 103;
 const unsigned short UNKNOWN_APPLICATION_ID = 104;
 const unsigned short ALREADY_INSTALLED = 105;
 const unsigned short INSTALLATION_ERROR_OTHER = 106;
 readonly attribute unsigned short code;
 readonly attribute DOMString applicationID;
};

interface Widget {
 //Deploys a child application known to the WRT through the definition in the application s manifest
 //file on another device. If local = false or not specified the WRT has to provide a list of available
 //devices to the user where the application should be installed on, if local = true the WRT has to
 //install the selected child on the same device as the API is bound to.
 void deployChild(in DeploymentSuccessCallback onSuccess, in DeploymentErrorCallback onError, in DOMString childApplicationID, in optional boolean local);
}
</code></pre>

To install a child on a selected remote device the webinos device discovery API can be used to find available Widget API services on other devices where deployChild can be used remotely.

### Exposing Application Functionalities as Service to other Applications

As introduced in the beginning of this section webinos application may share its functionalities across other applications. To make functions available to others the shared element containing a number of shared-function and shared-api elements must be added to the application’s configuration document. The content of the shared-function element must be a JavaScript function defined in the JavaScript part of the application which will be accessible to other applications using webinos discovery services and searching for services with the type defined in the id attribute of the widget element. To group functions and allow exposing of multiple APIs at the same time the shared-api element can be used. The shared-api element must have an api-name attribute which uniquely identifies the exposed API. The service can then be instantiated by using the webinos discovery service while using the api-name as input parameter for the service type of the service that should be discovered.

Example of Usage:

<pre><code class="xml">
<widget xmlns="http://www.w3.org/ns/widgets"
 xmlns:webinos="http://www.webinos.org/webinosapplication"
 id="http://exampleapp.org/app1">
 <webinos:shared>
 <webinos:shared-api api-name="http://www.w3.org/ns/api-perms/geolocation">
 <webinos:shared-function>watchPosition</webinos:shared-function>
 <webinos:shared-function>getCurrentPosition</webinos:shared-function>
 <webinos:shared-function>clearWatch</webinos:shared-function>
 </webinos:shared-api>
 <webinos:shared-function>exampleFuntion</webinos:shared-function>
 </webinos:shared>
 <content src="widget.html"/>
</widget>
</code></pre>

The visibility of the shared functions can be restricted to be only accessible by a parent application, a child application or an application running in the same personal zone. To define this, the visibility attribute of the shared-function element can be used. For example:

`<webinos:shared-function visibility=â€parentâ€>function1</webinos:shared-function> allows only a parent application to access function1.`
`<webinos:shared-function visibility=â€childâ€>function2</webinos:shared-function> allows only a child application to access function2.`
`<webinos:shared-function visibility=â€personal-zoneâ€>function3</webinos:shared-function> allows only applications running in the same personal zone as the service application to access function3.`

To define whether the service is permanently available (always running) or only after the application was started by the user or using the Applauncher API the available attribute of the shared element can be used. If it is set to ‘permanent’ the application is always running, thus, the exposed functions can be found by using the discovery API at any time the hosting device is connected. All other values or the absent of the attribute results in unavailability of the service unless the application that exposes the service functions is started.

<pre><code class="xml">
<widget xmlns="http://www.w3.org/ns/widgets"
 xmlns:webinos="http://www.webinos.org/webinosapplication"
 id="http://exampleapp.org/app1">
 <webinos:shared available="permanent">
 …
 </webinos:shared>
 <content src="widget.html"/>
</widget>
</code></pre>

To use functions exposed by webinos applications a reference to the application is needed. To get a reference to an object that provides access to the exposed functions the webinos JavaScript discovery API can be used while providing the query with the unique identifier of the API or application. The object returned by the webinos runtime is enriched with the Widget interface containing the application name, description, author, and version name beside of the features provided by the queried interface. For example accessing function 1 from the above example would in JavaScript look like:

<pre><code class="javascript">
 function showMap(location){
 //doing some logic
 }

function successCB(myLocationService) {
 alert(‘Service ’ + myLocationService.displayName + ‘ ready to use’);

//invoking a function exposed by the application
 myLocationService.webinos.extensions.getCurrentPosition(showMap);
 }

function successCB2(myservice) {
 alert(‘Service ’ + object.displayName + ‘ ready to use’);

//invoking a function exposed by the application
 myservice.webinos.extensions.exampleFuntion();
 }

window.webinos.findServices({api:‘http://www.w3.org/ns/api-perms/geolocation’}, {onFound:successCB});
 window.webinos.findServices({api:‘http://exampleapp.org/app1’}, {onFound:successCB2});

</code></pre>

The actual functionality, the signature of the functions as well as the function names of the exposed functions must be known to the developer. A semantic description of the functions behaviour is out of scope of the specification. As you can see in the above example the default name space where an API is attached to in the returned object is webinos.extensions. Each exposed function is available using this prefix. If it is needed to make the exposed functions available under a specific path then this can be optionally defined using the api-path attribute of the shared-api element (e.g., if the application exposes a well known API, such as geolocation, that has a defined way of accessing it).

**Example of Usage: Defining an API path for an exposed API**
<pre><code class="xml">
<widget xmlns="http://www.w3.org/ns/widgets"
 xmlns:webinos="http://www.webinos.org/webinosapplication"
 id="http://exampleapp.org/app1">
 <webinos:shared>
 <webinos:shared-api api-name="http://www.w3.org/ns/api-perms/geolocation" api-path="window.navigator.geolocation">
 <webinos:shared-function>watchPosition</webinos:shared-function>
 <webinos:shared-function>getCurrentPosition</webinos:shared-function>
 <webinos:shared-function>clearWatch</webinos:shared-function>
 </webinos:shared-api>
 </webinos:shared>
 <content src="widget.html"/>
</widget>
</code></pre>

Using the above example makes the API available under myLocationService.navigator.geolocation.getCurrentPosition() instead of myLocationService.webinos.extensions.getCurrentPosition(showMap) when the api-path is not declared.

**Interfacing between Child and Parent Applications**

Since webinos supports a distributed application design the possibility of communication between application parts must be assured by the system. Webinos supports this by providing information about deployed child applications. As introduced in the previous section webinos provides a unique service ID for deployed child applications. This service ID can either be used for instantiating a remote binding to the child application in order to use exposed functions (if any) or it can be used to uniquely address an application within the webinos event API. Thus, a parent application can communicate with its child applications.

For the other way around, to let the child application know the unique identity of its parent application, the child application can be explicitly informed about the parent’s identifier. Thus, after the parent receives a success callback it should instantiate the client and call a function which takes the parent’s identifier using the getServiceId function from the ServiceDiscovery API. An exemplary flow could be:

<pre><code class="javascript">

function bindcallback(Service service){
 service.setParent(window.webinos.discovery.getServiceId("http://www.webinos.org/webinosapplication"));
};

function onError(in DeploymentError error){
 alert(error.code);
};

function onSuccess(in DOMString childID, in DOMString serviceID){
 var service = window.webinos.discovery.createService();
 service.bind({onBind:bindcallback},childID);
};

window.widget.deployChild(onSuccess, onError, "http://www.exampleapp.org/app1");

</code></pre>

### Hosted Webinos Applications

Apart from supporting installable applications, webinos supports the execution of hosted web applications which does not require a permanent installation. Hosted applications can also make use of webinos-specific functionalities if the needed features are declared in the related application manifest. To attach metadata and configuration data to hosted applications, the W3C packaging and configuration is extended. The src attribute of the content element in the application configuration document of a widget file (.wgt) is allowed to point to an absolute path outside of the application package. In this case there is no need to include any other content in the package but it is still allowed. Thus, mixing local installed content and remote content is possible.

<pre><code class="xml">
<widget xmlns="http://www.w3.org/ns/widgets">
 <content src="http://www.hostedapps.com/hostedApp1.html"/>
</widget>
</code></pre>

Making the hosted application available to the user works the same as installing a packaged webinos web application. A .wgt package file is provided to the WRT and processed. If the WRT detects that an application is a hosted application the WRT has to add links to the application in order to make them accessible to the user. This, for example, can be done by placing the referenced application icon in an application gallery or by maintaining a bookmark list. The WRT has to inform the user about unavailability of a hosted application if there is no internet connection available.

In addition to the absolute path of the start document of a hosted application the scope of the application must be defined using the access element in order to allow access to needed documents and to apply related policies.

The access element is defined in the Widget Access Request Policy [WARP] which is applied for hosted applications.

**Example of Usage:** Application is defined using a root path
<pre><code class="xml">
<widget xmlns="http://www.w3.org/ns/widgets">
 <content src="http://www.hostedapps.com/hostedApp1/run.html"/>
 <access origin="http://www.hostedapps.com/hostedApp1/"/>
</widget>
</code></pre>

**Example of Usage:** Application is defined using absolute paths to the applications documents
<pre><code class="xml">
<widget xmlns="http://www.w3.org/ns/widgets">
 <content src="http://www.hostedapps.com/hostedApp2/run.html"/>
 <access origin="http://www.hostedapps.com/hostedApp2/run.html"/>
 <access origin="http://www.hostedapps.com/hostedApp2/style.css"/>
 <access origin="http://www.hostedapps.com/hostedApp2/main.js"/>
</widget>
</code></pre>

Formal Specification Webinos Web Runtime Environment
----------------------------------------------------

This section specifies a number of functional and non functional requirements related to the WRT itself. This includes how webinos applications are shared between devices, how the application life cycle is handled, how webinos applications can be installed on WRTs, and which Web technologies must be supported by webinos WRTs in order to define a common set of available functionality.

### Inter-Runtime Application Deployment

Webinos provides the ability to exchange webinos applications between devices including export of applications to the file system to be manually installed on another device and automatic installation using provided WRT functionalities. This includes whole application packages as well as child application packages which are included in a main application package. If a WRT is asked by the user to install a select application on another device the WRT has to provided a meaningful UI for selecting a target device which includes, e.g, discovery of nearby devices or of devices in the same personal zone.

For installing application on other devices within webinos the following events are defined and must be supported by the WRT. The same mechanism is applied if an application for remote deployment is selected using the JavaScript Widget API for code deployment or the automatic deployment during application installation time is applied.

**Requesting a Remote Installation on another device:**

Event type must be: http://webinos.org/events/application/request-installation
Event payload must be a JSON object with following attributes:
<pre><code class="javascript">
{
 name: [the name of the application that should be remotely installed]
 description: [the description of the application that should be remotely installed]
 version: [the version of the application that should be remotely installed]
 author: [the author of the application that should be remotely installed]
 id: [the application ID of the application that should be remotely installed]
 size: [the size of the application package in number of bytes]
 uri: [optional, an URI where the WRT that is requested to install an application can retrieve the application code]
 payloadInstallation: [optional, TRUE or FALSE while true means that an application transmission using the webinos event mechanism is requested, e.g, if an uri cannot be provided]
}
</code></pre>

**Answer to a remote installation request:**

Event type must be: http://webinos.org/events/application/request-installation-response
Event payload must be a JSON object with following attributes:
<pre><code class="javascript">
{
 payloadInstallation: [optional, TRUE if an application transmission using the webinos event mechanism is accepted]
 code: [optional if payloadInstallation is used, error code as specified in the webinos widget specification extension or 1 for a successful installation]
 id: [the application ID of the application that should be remotely installed]
 uniqueID: [optional if payloadInstallation is used, a unique id of the application that represents exactly this application installation which can be used for service discovery or remote application launch]
}
</code></pre>

**Sending application using payload:**

Event type must be: http://webinos.org/events/application/payload-installation?id=[application id, must be the same as previously requested in request-installation otherwise the event must be dropped]
Event payload: [the binary data of the application]

After installation another request-installation-response must be sent to the initiating device.

### Application Life Cycle

Webinos applications can be made available through a number of different deployment methods including installation via web sites, application stores, file system, other webinos web runtimes, simple application sharing and application advertisement, and execution of hosted applications (no installation). Upon installation of a webinos application package, the web runtime must process the package as specified in the webinos application packaging specification. Additionally a webinos web runtime must implement the following requirements.

`WRT-05: The WRT MUST sent a User Agent Identification containing vendor, name, version of WRT with each HTTP/HTTPS request to be used for identifying available features provided by the WRT.`

`WRT-06: If possible the webinos WRT MUST catch content which is of MIME type application/widget in order to install the application or execute the application if already installed and up to date.`

`WRT-07: If possible the webinos WRT MUST catch the invocation of files with a .wgt extension in order to install the application or execute the application if already installed and up to date.`

`WRT-08: The WRT MAY check the applications configuration document for compatibility with the features provided by the runtime.`

`WRT-09: The WRT MUST provide means to install locally available applications on another device which can be selected by the user in conformance with section 2 of this specification.`

`WRT-10: The WRT MUST provide a list of application available to the user for local installation or remote usage.`

`WRT-11: The WRT MUST delete all data specific to an application if the application is uninstalled. This includes the un-installation of any child applications if they are depended on the parent application.`

`WRT-12: The WRT MUST use secure storage for webinos applications that are marked as copy protected. This should not allow to view, export, modify, or any other access of the application by other applications or the user (WAC).`

`WRT-13: The WRT MUST use encrypted storage for webinos applications in case that external or general accessible storage space is used (WAC) for storing application data.`

**Notify Widgets to Web Browsers**

It is possible to notify the availability of widgets to Web browsers using the HTML <link> element in common web sites. Thus, common Web Browsers may show the availability of installable applications to the user including the possibility of installing them into the system. In advance, the browser should check if a Widget handler, e.g., a webinos WRT, is registered in the system. The <link> element’s type attribute must be set to "application/widget" to define the MIME type of the linked resource. The _title_ attribute should be set to the widgets title. The _href_ attribute must contain the link to the application package. The link type defined by the _rel_ attribute must be set to "alternate".

<pre><code class="xml">
<link rel="alternate"
 type="application/widget"
 title="Application Title"
 href="http://www.applicationhost.com/application.wgt">
</link>
</code></pre>

**Life Cycle API**

Webinos provides some APIs to allow developers to manage their application’s life cycle during application execution. While the application itself cannot influence its execution life cycle status Webinos allows for registering callbacks in case the application will be destroyed and can’t be resumed, will go to background/foreground or will be stopped/started again or resumed.

<pre><code class="javascript">
interface NotifySuccessCallback{

//Called if an event was accepted by the user. If provided, the notification id is passed in to link the success to a specific event
 onSuccess(in DOMString id);
}

interface Widget {

//allows an application to trigger calling destroy from the runtime
 void exit();

//sends the application to background if possible so that it is not visible to the user anymore
 //if possible by the platform the application execution goes on
 void hide();

//asks the WRT wheather the application is currently hidden (not visible to the user) or not
 //if the application is hidden it may notify an event to the user using notify
 boolean isHidden();

//Triggers the WRT to notify occurrence of an event, as described using the parameters, to the user
 //The user can click the event. If the application is in background and the user accepted the event
 //, e.g., by clicking on it, the application must be brought back to foreground. The notify success
 //callback is then called after onForeground was called.
 void notify(in NotifySuccessCallback onSuccess, in NotifyErrorCallback onError, in DOMString title, in optional DOMString shortDescription, in optional DOMString id, in optional DOMString icon);

//To cancel a previous notify because it is updated or expired (if ongoing / not clicked by the user)
 void cancelNotify(in DOMString id);

//Callback function which is called if the application will be shut down by the WRT. All application memory
 //assigned to the application will be freed after returning out of this function.
 void onDestroy();

//Callback function which is called after the application was put to background, e.g., another application
 //goes to foreground and the application is not visible any more. After calling onBackground the application
 //is still running but not visible anymore.
 void onBackground();

//Callback function which is called if the application goes to foreground after previously going to background.
 void onForeground();

//Callback function which is called if application execution is stopped by the WRT.
 void onStop();

//Callback function which is called if application execution is continued after previously interrupted.
 void onStart();

};
</code></pre>

**Application Update**

[WidgetUpdate] defines how packaged web applications (Widgets) can be updated over http. For hosted web applications without any content in the application package there is no need for local update checks. All updates are applied directly remotely on the hosting web server and locally applied at the next execution of the application.

`The webinos WRT MUST be capable of updating webinos application packages as defined in W3C Widget Updates over HTTP [WidgetUpdate].`

Child applications may also be updated using [WidgetUpdate]. Another option for can be re-installing the child application which is initiated by itâ€™s parent application which was previously updated using [WidgetUpdate]. Here, the new version of the application that should be re-installed must be different from the version currently installed. Otherwise its rejected.

**Application de-installation**

The WRT must provide functionalities to permanently remove applications from the device on demand of the user. It may appear the child-applications on other devices become non-functional without their parent application. The developer can declare this within the configuration document in the child element. If the optional attribute _parentneeded_ is set to true the WRT has to store the application instance IDs provided by the remote installation process. These IDs must be used to request de-installation on remote devices in case the parent application is deleted.

**Example of Usage:**

<pre><code class="xml">
<widget xmlns="http://www.w3.org/ns/widgets"
 xmlns:webinos="http://www.webinos.org/webinosapplication"
 id=â€http://exampleapp.org/app1â€ webinos:type="container">
 <webinos:child webinos:parentneeded=â€trueâ€>child2.wgt</webinos:child>
</widget>
</code></pre>

**Events for remote de-installation**
Event type must be: http://webinos.org/events/application/request-deinstallation
Event payload must be a JSON object with following attributes:
<pre><code class="javascript">
{
 id: [the application ID of the application that should be deleted]
 uniqueID: [the unique instance id of the application that represents exactly this application installation]
}
</code></pre>

Event type must be: http://webinos.org/events/application/request-deinstallation-response
Event payload must be a JSON object with following attributes:
<pre><code class="javascript">
{
 code: [error code as specified in the DeploymentError of the webinos widget specification or 1 in case of successfull de-installation]
 id: [the application ID of the application that should be deleted]
 uniqueID: [the unique instance id of the application that represents exactly this application installation]
}
</code></pre>

In case a remote de-installation was not successful the WRT has to inform the user about this and about that a manual de-installation may be needed.

**Automatic execution of Applications**

Beside user driven application execution, webinos applications can be automatically initiated by events coming from webinos itself or from other applications. Webinos WRT allows registering for event types which triggers the execution of the application. Events for automatic execution can be application specific ones or predefine webinos events. Subscription to application execution events can be made programmatically using the webinos Event API and described using a new webinos element as child of the <content> element in the applications configuration document.

**Example of Usage:** Descriptive registration for application execution events
<pre><code class="xml">
<widget xmlns="http://www.w3.org/ns/widgets" xmlns:webinos="http://www.webinos.org/webinosapplication" webinos:type="background">
 <content src="http://www.hostedapps.com/hostedApp2/run.js"/ >
 <webinos:start>http://webinos.org/events/core/BOOT_UP_COMPLETED</webinos:start>
 <webinos:start>http://www.hostedapps.com/hostedApp2/eventtypes/event1</webinos:start>
 </content>
</widget>
</code></pre>

Predefined Events that must be supported by the WRT:

**http://webinos.org/events/core/BOOT_UP_COMPLETED**
If the device and the WRT is ready to execute applications the WRT must auto start applications registered to this event.

**Applications without UI**

Webinos application can be executed in a no user interaction (UI) mode which means that the application is invisible to the user and the user cannot directly interact with the application. After starting a background application it will be executed and is responsive to potential incoming request as long as the application is running (not stopped by the user or by the service itself). To express that an application is a no UI application type _type_ attribute is added to the <widget> element of the application’s configuration document. If _type_ is ‘background’ the application is marked as no UI / background application. In any other cases the application is handled as normal application. The WRT must provide means to manage background applications by the user. E.g., start a background application, show running background applications and terminate background applications.

**Example of Usage:** Declaring an application as background application
<pre><code class="xml">
<widget xmlns="http://www.w3.org/ns/widgets" xmlns:webinos="http://www.webinos.org/webinosapplication" webinos:type="background">
 <content src="http://www.hostedapps.com/hostedApp2/run.js"/>
</widget>
</code></pre>

### Extensions in webinos

{{export_include(Extensions Specification

</div>
### Web Technologies

`Note: The following section is preliminary and may be subject to change in future versions of the specification.`

A Web runtime which is able to render webinos applications and wants to claim to be compliant to the webinos specification must support following web technologies whereas the concrete mandatory version and feature set of each one is further defined in the Wholesale Application Community Core Specification Version 2.0 Section 2 [WACWebTech].

-   XML and HTML Markup Language
-   JavaScript (JS)
-   Cascading Style Sheets (CSS)
-   XmlHttpRequest
-   Scalable Vector Graphics (SVG)

Beside of the definition of web technologies to be supported [WACWebTech] defines URI schemes to allow launching of specific applications. The following URI schemes must be supported by webinos runtimes:

-   "http/https" in order to launch a web browser
-   "tel" in order to initiate a call
-   "sms" in order to send a short message service (SMS) message
-   "mmsto" in order to send a multimedia massaging service (MMS) message
-   "mailto" in order to send an email message
-   "data" in order to directly embed content (e.g., data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAA…)

4. References
=============

[Widgets] http://www.w3.org/TR/widgets/
[WidgetAPI] http://www.w3.org/TR/2011/WD-widgets-apis-20110607/
[WidgetUpdate] http://www.w3.org/TR/2010/WD-widgets-updates-20100928/
[WidgetURI] http://www.w3.org/TR/2009/WD-widgets-uri-20091008/
[WidgetDigSig] http://www.w3.org/TR/2011/WD-widgets-digsig-20110607/
[WARP] http://www.w3.org/TR/2010/CR-widgets-access-20100420/
[WAC] http://specs.wacapps.net/2.0/jun2011/
[WACWebTech] http://specs.wacapps.net/2.0/jun2011/core/web-standards.html

